<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Outwit Theme Designer 使用指南</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/site-shell.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="inner">
        <a class="site-brand" href="/" rel="noreferrer">
          <img src="/logo-circling.svg" alt="几维输入法 logo" />
          <span>几维输入法 · Outwit IME</span>
        </a>
        <span class="site-title">主题设计工具</span>
        <nav class="site-nav">
          <a href="/" rel="noopener">返回首页</a>
          <a
            href="https://github.com/levelel/outwit-theme-designer"
            target="_blank"
            rel="noreferrer"
            class="icon-link"
            aria-label="Theme Designer GitHub"
            title="Theme Designer GitHub"
          >
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M12 .5C5.649.5.5 5.649.5 12c0 5.088 3.292 9.397 7.864 10.918.575.108.785-.253.785-.561 0-.277-.01-1.012-.016-1.988-3.2.695-3.877-1.542-3.877-1.542-.523-1.329-1.277-1.684-1.277-1.684-1.044-.714.079-.699.079-.699 1.154.081 1.762 1.186 1.762 1.186 1.027 1.761 2.695 1.252 3.352.957.104-.744.402-1.252.73-1.54-2.554-.29-5.238-1.277-5.238-5.683 0-1.255.448-2.281 1.183-3.086-.119-.29-.513-1.457.112-3.038 0 0 .965-.309 3.164 1.179a10.93 10.93 0 0 1 2.882-.387 10.9 10.9 0 0 1 2.882.387c2.199-1.488 3.162-1.179 3.162-1.179.627 1.581.234 2.748.115 3.038.737.805 1.183 1.831 1.183 3.086 0 4.417-2.689 5.39-5.252 5.675.414.358.78 1.062.78 2.14 0 1.545-.014 2.793-.014 3.17 0 .311.207.674.791.56C20.21 21.394 23.5 17.085 23.5 12c0-6.351-5.149-11.5-11.5-11.5Z"
              />
            </svg>
          </a>
        </nav>
      </div>
    </header>
    <main class="guide-main">
      <h1>使用指南</h1>
      <p class="guide-lead">快速了解如何加载预设、调色、导出 YAML 主题配置。</p>

        <h2>1. 选择或加载主题</h2>
        <ol>
          <li>打开“主题信息”模块，使用下拉菜单选择内置预设。</li>
          <li>如需回到预设原始状态，点击“重置”按钮，系统会重新加载当前预设。</li>
          <li>自定义方案可直接在输入框中修改 `color_scheme` 与显示名称。</li>
        </ol>
      </section>


        <h2>2. 调整颜色参数</h2>
        <ol>
          <li>在“颜色设置”面板里逐项调节候选条、标签、注释等颜色。</li>
          <li>预览区域会同步展示横排与竖排两种布局，便于对比。</li>
          <li>颜色字段支持 HEX/rgba，建议保持透明度为 0 或 1 以避免渲染差异。</li>
        </ol>


        <h2>3. 导出主题</h2>
        <ol>
          <li>确认主题效果后，点击“导出配置”。</li>
          <li>系统会生成 YAML 文件，文件名来源于 `color_scheme`。</li>
          <li>将 YAML 文件复制至 Outwit/Rime 配置目录相应位置即可使用。</li>
        </ol>


        <h2>4. 在输入法里启用</h2>
        <ol>
          <li>Outwit 用户：在「用户目录」找到 `themes` 目录，把生成的文件放到这个文件夹下。然后在找到 `outwit.custom.yaml`，将导出的 `preset_color_schemes` 片段合入后重新部署。或者在设置界面中选择导入的主题后保存并部署。</li>
          <li>小狼毫 (Weasel) 用户：编辑 `weasel.custom.yaml`；鼠须管 (Squirrel) 用户：编辑 `squirrel.custom.yaml`，两者均位于 Rime 用户文件夹。</li>
          <li>
            更多 YAML patch 语法与外观定制方法可参考
            <a
              href="https://github.com/rime/home/wiki/CustomizationGuide#%E5%B0%8F%E7%8B%BC%E6%AF%AB%E5%A4%96%E8%A7%80%E8%A8%AD%E5%AE%9A"
              target="_blank"
              rel="noreferrer"
            >Rime 定製指南</a>。
          </li>
        </ol>

      <a class="guide-back-link" href="/" rel="noopener">
        ← 返回主题设计工具
      </a>
    </main>
    <script>
      (function () {
        const raw = localStorage.getItem("otd-theme");
        if (!raw) return;
        let theme;
        try {
          theme = JSON.parse(raw);
        } catch (err) {
          return;
        }
        const root = document.documentElement;
        function parseHex(color) {
          if (!color || color[0] !== "#") return [255, 255, 255];
          return [
            parseInt(color.slice(1, 3), 16),
            parseInt(color.slice(3, 5), 16),
            parseInt(color.slice(5, 7), 16),
          ];
        }
        function luminance([r, g, b]) {
          r /= 255;
          g /= 255;
          b /= 255;
          const a = [r, g, b].map((v) =>
            v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4),
          );
          return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
        }
        function idealTextColor(hex) {
          return luminance(parseHex(hex)) > 0.6 ? "#111111" : "#f2f2f2";
        }
        function blendColors(base, overlay, alpha) {
          const [br, bg, bb] = parseHex(base);
          const [or, og, ob] = parseHex(overlay);
          const r = Math.round(or * alpha + br * (1 - alpha));
          const g = Math.round(og * alpha + bg * (1 - alpha));
          const b = Math.round(ob * alpha + bb * (1 - alpha));
          return `#${r.toString(16).padStart(2, "0")}${g
            .toString(16)
            .padStart(2, "0")}${b.toString(16).padStart(2, "0")}`;
        }
        function stringOr(value, fallback) {
          return typeof value === "string" && value.trim() ? value : fallback;
        }
        const bg = stringOr(theme.back_color, "#121212");
        const text = stringOr(theme.text_color, idealTextColor(bg));
        const label = stringOr(theme.label_color, text);
        const comment = stringOr(theme.comment_text_color, "#b5b5b5");
        const accent = stringOr(theme.hilited_candidate_back_color, "#4caf50");
        const accentText = stringOr(
          theme.hilited_comment_text_color,
          stringOr(theme.hilited_candidate_text_color, idealTextColor(accent)),
        );
        const tabActiveText = stringOr(theme.candidate_text_color, label);
        const lightness = luminance(parseHex(bg));
        const isLight = lightness > 0.6;
        const panel = isLight ? "rgba(0,0,0,0.05)" : "rgba(255,255,255,0.05)";
        const panelBorder = isLight
          ? "rgba(0,0,0,0.12)"
          : "rgba(255,255,255,0.12)";
        const inputBg = isLight ? "rgba(0,0,0,0.08)" : "rgba(255,255,255,0.08)";
        const inputBgFocus = isLight
          ? "rgba(0,0,0,0.12)"
          : "rgba(255,255,255,0.12)";
        const dropdownSurface = blendColors(
          bg,
          isLight ? "#000000" : "#ffffff",
          isLight ? 0.25 : 0.18,
        );
        root.style.setProperty("--bg", bg);
        root.style.setProperty("--text", text);
        root.style.setProperty("--label", label);
        root.style.setProperty("--comment", comment);
        root.style.setProperty("--accent", accent);
        root.style.setProperty("--accent-text", accentText);
        root.style.setProperty("--theme-color", accent);
        root.style.setProperty("--tab-active-text", tabActiveText);
        root.style.setProperty("--panel", panel);
        root.style.setProperty("--panel-border", panelBorder);
        root.style.setProperty("--select-dropdown-surface", dropdownSurface);
        root.style.setProperty("--select-dropdown", inputBg);
        root.style.setProperty("--input-bg", inputBg);
        root.style.setProperty("--input-bg-focus", inputBgFocus);
      })();
    </script>
  </body>
</html>
